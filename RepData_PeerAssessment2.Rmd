---
title: "R Notebook Reproducible Research Peer Assessment 2"
output: html_notebook
---


```{r, echo=FALSE, results="hide", include=FALSE}
  # Enviroment 
  # Loading and preprocessing the data
  #Set up enviroment for R scrip  
  # Packages for tidyverse 
    library("tidyverse")
    library("lubridate")
  # Package for building tables in markdown and notebook 
    library("knitr")
    library("kableExtra") 
    library("xtable")
  # Package for forecasting
    library("fpp2")
  # Packages for reading excel and html files and XML
    library("openxlsx")
    library("XML")
  # Parkage for using data tables for very large data operations
    library("data.table")
  #Package for reading fixed width tables
    library("utils")
  # Packages for reading data through API's 
    library("httr")
    library("jsonlite")
  # Package for performing inquires with SQL databases 
    library("sqldf")
  #Package for reading and writing to jpeg files
    library("jpeg")

  # Set proper working Dir
    if (!getwd() == "C:/Users/paulr/Documents/R/Coursera_ReproducibleResearch/RepData_PeerAssessment2") {setwd("C:/Users/paulr/Documents/R/Coursera_ReproducibleResearch/RepData_PeerAssessment2")}
```

# Get data
# Set proper working Dir
if (!getwd() == "C:/Users/paulr/Documents/R/GettingAndCleaningData") {setwd("./GettingAndCleaningData")}
getwd()

# Check for data directory and if one is not present then make it
if (!file.exists("data")) {
  dir.create("data")
}

# Download data using a URL into th data directory
fileUrl <- "https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2Fss06hid.csv"
download.file(fileUrl, destfile = "./data/AmericanConsumer")
dateDownloaded <- date()
dateDownloaded
list.files("./data")

 
 
 
 
# Read data 

```{r, echo=TRUE, results=FALSE, cache=TRUE}
stormdata <- read_csv("./data/repdata_data_StormData.csv.bz2", col_names = TRUE)
stormdata %>% select(EVTYPE, STATE__, BGN_DATE, COUNTYNAME, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP) -> storm_health_cost
storm_health_cost$BGN_DATE <- date(mdy_hms(storm_health_cost$BGN_DATE))
    
```

# Look at the data
```{r}



length(unique(storm_health_cost$PROPDMGEXP )) 
unique(storm_health_cost$PROPDMGEXP)

storm_health_cost %>% filter(PROPDMGEXP == "?") -> answer2
summary(answer2)
answer2


storm_health_cost %>% select(EVTYPE, BGN_DATE, FATALITIES, INJURIES) %>%
  mutate(Health = FATALITIES + INJURIES) %>% group_by(EVTYPE,BGN_DATE) %>% 
  summarise(Health = sum(Health)) %>% arrange(desc(Health)) -> answer1

(sum(storm_health_cost$FATALITIES) + sum(storm_health_cost$INJURIES))
glimpse(answer1)

summary(storm_health_cost$PROPDMGEXP)
```
Number of unique events: `r Events`




